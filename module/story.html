<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>ë‘ë‡Œ íŠ¼íŠ¼ - ìˆœì„œ ë§ì¶”ê¸° (ë‹¤í¬ëª¨ë“œ + ë“œë˜ê·¸)</title>
  <style>
    :root {
      --bg-color: #121212;
      --card-bg: #1e1e1e;
      --text-main: #ffffff;
      --text-sub: #aaaaaa;
      --primary: #4dacff;
      --border: #444444;
      --correct: #4cd964;
      --wrong: #ff5f5f;
    }

    body {
      margin: 0;
      padding: 20px 10px;
      font-family: "Pretendard", "Noto Sans KR", sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ (ë“œë˜ê·¸ ê°„ì„­ ë°©ì§€) */
    }

    .container {
      width: 100%;
      max-width: 600px;
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      box-sizing: border-box;
      border: 1px solid #333; 
    }

    header { text-align: center; margin-bottom: 30px; }
    h1 { margin: 0 0 10px; font-size: 26px; color: var(--primary); }
    p.desc { margin: 0; font-size: 19px; color: var(--text-sub); line-height: 1.5; }

    .progress-bar { display: flex; justify-content: center; gap: 8px; margin-bottom: 30px; }
    .dot { width: 12px; height: 12px; border-radius: 50%; background: #444; transition: background 0.3s; }
    .dot.active { background: var(--primary); transform: scale(1.2); }

    /* --- ë“œë˜ê·¸ íƒ€ê²Ÿ (ë¹ˆì¹¸) --- */
    .slots-area {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 40px;
      padding: 16px;
      background-color: #262626;
      border-radius: 16px;
      border: 2px dashed #555;
      transition: border-color 0.2s, background-color 0.2s;
    }
    
    /* ë“œë˜ê·¸í•´ì„œ ìœ„ì— ì˜¬ë¼ì™”ì„ ë•Œ ê°•ì¡° íš¨ê³¼ */
    .slots-area.drag-over {
      border-color: var(--primary);
      background-color: #2a3b4d;
    }

    .slot {
      min-height: 68px;
      background: #333;
      border: 2px solid var(--border);
      border-radius: 12px;
      display: flex;
      align-items: center;
      padding: 10px 16px 10px 50px;
      font-size: 20px;
      font-weight: 500;
      position: relative;
      color: #ddd;
      transition: all 0.2s;
    }
    
    .slot::before {
      content: attr(data-num);
      position: absolute;
      left: 16px;
      color: #666;
      font-size: 24px;
      font-weight: 800;
    }

    .slot.filled {
      border-color: var(--primary);
      background-color: #2a3b4d;
      color: #fff;
      font-weight: bold;
      cursor: pointer; /* ì±„ì›Œì§„ ê±´ ëˆ„ë¥´ë©´ ë¹ ì§ */
    }
    .slot.filled::before { color: var(--primary); }
    .slot.filled::after {
      content: "âœ•"; 
      position: absolute;
      right: 16px;
      color: var(--primary);
    }

    /* --- ë“œë˜ê·¸ ì†ŒìŠ¤ (ë³´ê¸°) --- */
    .options-area { display: flex; flex-direction: column; gap: 12px; }
    
    .option-btn {
      background: #333;
      border: 2px solid #555;
      color: #eee;
      padding: 18px;
      border-radius: 12px;
      font-size: 20px;
      text-align: left;
      cursor: grab; /* ì†ë°”ë‹¥ ëª¨ì–‘ (ë“œë˜ê·¸ ê°€ëŠ¥ ì•”ì‹œ) */
      transition: transform 0.1s, opacity 0.2s, background 0.2s;
    }
    
    .option-btn:active { cursor: grabbing; }

    /* ë“œë˜ê·¸ ì¤‘ì¸ ì›ë³¸ ìŠ¤íƒ€ì¼ */
    .option-btn.dragging {
      opacity: 0.5;
      background: var(--primary);
      border-color: var(--primary);
    }
    
    .option-btn.selected {
      opacity: 0.3;
      background: #222;
      border-color: #333;
      pointer-events: none;
      text-decoration: line-through;
    }

    .result-area { margin-top: 40px; text-align: center; }
    .message { font-size: 22px; font-weight: bold; margin-bottom: 20px; min-height: 30px; }
    .message.good { color: var(--correct); }
    .message.bad { color: var(--wrong); }

    .action-btn {
      width: 100%;
      padding: 18px;
      font-size: 22px;
      font-weight: bold;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      color: #000;
      background-color: var(--primary);
      transition: opacity 0.3s;
    }
    .action-btn:disabled {
      background-color: #444;
      color: #888;
      cursor: not-allowed;
    }

    .a11y-hint {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
      text-align: center;
    }
  </style>
</head>
<body>

  <div class="container">
    <header>
      <h1>ë‘ë‡Œ íŠ¼íŠ¼ í€´ì¦ˆ</h1>
      <p class="desc" id="storyTitle">ìˆœì„œëŒ€ë¡œ ë¹ˆì¹¸ì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</p>
    </header>

    <div class="progress-bar" id="progressBar"></div>

    <div class="slots-area" id="dropZone">
        </div>
    <div class="a11y-hint">â€» ê¸€ìë¥¼ ëˆ„ë¥´ê±°ë‚˜ ëŒì–´ì„œ ìœ„ë¡œ ì˜®ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>

    <div style="margin: 20px 0;"></div>

    <div class="options-area" id="optionsArea"></div>

    <div class="result-area">
      <div id="message" class="message"></div>
      <button id="mainBtn" class="action-btn" onclick="checkAnswer()">ì •ë‹µ í™•ì¸í•˜ê¸°</button>
    </div>
  </div>

  <script>
    const quizData = [
      {
        title: "ì‹ë¬¼ í‚¤ìš°ê¸°",
        steps: ["ì”¨ì•—ì„ ì‹¬ëŠ”ë‹¤", "ì‹¹ì´ ë‚˜ì˜¨ë‹¤", "ê½ƒì´ í•€ë‹¤"]
      },
      {
        title: "ì–‘ì¹˜ì§ˆ í•˜ê¸°",
        steps: ["ì¹˜ì•½ì„ ì§ ë‹¤", "ì´ë¥¼ ë‹¦ëŠ”ë‹¤", "ë¬¼ë¡œ í—¹êµ°ë‹¤"]
      },
      {
        title: "ì„¤ê±°ì§€ í•˜ê¸°",
        steps: ["ìˆ˜ì„¸ë¯¸ì— ì„¸ì œë¥¼ ë¬»íŒë‹¤", "ê·¸ë¦‡ì„ ë‹¦ëŠ”ë‹¤", "ë¬¼ë¡œ í—¹êµ°ë‹¤"]
      }
    ];

    let currentIdx = 0;
    let currentSlots = [null, null, null]; 
    let shuffledOptions = []; 
    let isFinished = false;
    let draggedItem = null; // ë“œë˜ê·¸ ì¤‘ì¸ ì•„ì´í…œ ë°ì´í„° ì €ì¥

    const els = {
      title: document.getElementById('storyTitle'),
      progress: document.getElementById('progressBar'),
      dropZone: document.getElementById('dropZone'), // ìŠ¬ë¡¯ ì»¨í…Œì´ë„ˆ
      options: document.getElementById('optionsArea'),
      msg: document.getElementById('message'),
      btn: document.getElementById('mainBtn')
    };

    function initQuiz() {
      currentSlots = [null, null, null];
      isFinished = false;
      draggedItem = null;
      
      els.msg.textContent = "";
      els.msg.className = "message";
      els.btn.textContent = "ì •ë‹µ í™•ì¸í•˜ê¸°";
      els.btn.disabled = true;
      els.btn.onclick = checkAnswer;

      const data = quizData[currentIdx];
      els.title.textContent = `[ë¬¸ì œ ${currentIdx + 1}] ${data.title}`;

      // ì§„í–‰ë°”
      els.progress.innerHTML = '';
      quizData.forEach((_, i) => {
        const dot = document.createElement('div');
        dot.className = `dot ${i === currentIdx ? 'active' : ''}`;
        els.progress.appendChild(dot);
      });

      // ë³´ê¸° ì„ê¸°
      shuffledOptions = data.steps.map((text, idx) => ({ text, originalIdx: idx }));
      shuffleArray(shuffledOptions);

      render();
    }

    function render() {
      renderSlots();
      renderOptions();
      
      const allFilled = currentSlots.every(s => s !== null);
      if (!isFinished) {
        els.btn.disabled = !allFilled;
      }
    }

    function renderSlots() {
      els.dropZone.innerHTML = "";
      for(let i=0; i<3; i++) {
        const slot = document.createElement('div');
        const item = currentSlots[i];
        
        slot.className = item ? "slot filled" : "slot";
        slot.setAttribute('data-num', i + 1);
        
        if (item) {
          slot.textContent = item.text;
          // í´ë¦­ ì‹œ ì·¨ì†Œ (ë‚´ë ¤ë³´ë‚´ê¸°)
          slot.onclick = () => {
            if(!isFinished) {
              currentSlots[i] = null;
              render();
            }
          };
        } else {
          slot.textContent = "ì—¬ê¸°ë¡œ ëŒì–´ì˜¤ì„¸ìš”";
          slot.style.color = "#555"; 
          slot.style.fontSize = "16px";
        }
        els.dropZone.appendChild(slot);
      }
    }

    function renderOptions() {
      els.options.innerHTML = "";
      shuffledOptions.forEach((opt) => {
        const btn = document.createElement('div');
        btn.className = "option-btn";
        btn.textContent = opt.text;
        
        // **[ë“œë˜ê·¸ ê¸°ëŠ¥ ì¶”ê°€]**
        btn.setAttribute('draggable', 'true');
        
        const isSelected = currentSlots.some(s => s && s.text === opt.text);

        if (isSelected) {
          btn.classList.add('selected');
        } else {
          if (!isFinished) {
            // 1. í´ë¦­ ì´ë²¤íŠ¸ (ê¸°ì¡´ ìœ ì§€)
            btn.onclick = () => insertItem(opt);
            
            // 2. ë“œë˜ê·¸ ì‹œì‘ ì´ë²¤íŠ¸
            btn.addEventListener('dragstart', (e) => {
              draggedItem = opt;
              btn.classList.add('dragging');
              // ë°ì´í„° ì „ì†¡ (í•„ìˆ˜)
              e.dataTransfer.effectAllowed = "copyMove";
              e.dataTransfer.setData('text/plain', JSON.stringify(opt));
            });
            
            // 3. ë“œë˜ê·¸ ì¢…ë£Œ ì´ë²¤íŠ¸
            btn.addEventListener('dragend', () => {
              btn.classList.remove('dragging');
              draggedItem = null;
              els.dropZone.classList.remove('drag-over');
            });
          }
        }
        els.options.appendChild(btn);
      });
    }

    // ë¹ˆì¹¸ì— ì•„ì´í…œ ë„£ëŠ” ë¡œì§ (í´ë¦­/ë“œë¡­ ê³µìš©)
    function insertItem(item) {
      const emptyIdx = currentSlots.findIndex(x => x === null);
      if (emptyIdx === -1) return; 
      currentSlots[emptyIdx] = item;
      render();
    }

    // --- ë“œë¡­ì¡´(ë¹ˆì¹¸ ì˜ì—­) ì´ë²¤íŠ¸ ì²˜ë¦¬ ---
    els.dropZone.addEventListener('dragover', (e) => {
      e.preventDefault(); // ë“œë¡­ í—ˆìš©
      if(!isFinished) {
        els.dropZone.classList.add('drag-over');
      }
    });

    els.dropZone.addEventListener('dragleave', (e) => {
      els.dropZone.classList.remove('drag-over');
    });

    els.dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      els.dropZone.classList.remove('drag-over');
      
      if(isFinished) return;
      if(draggedItem) {
        insertItem(draggedItem);
        draggedItem = null; // ì´ˆê¸°í™”
      }
    });

    function checkAnswer() {
      const data = quizData[currentIdx];
      const userAnswers = currentSlots.map(s => s.text);
      const isCorrect = JSON.stringify(userAnswers) === JSON.stringify(data.steps);

      if (isCorrect) {
        els.msg.textContent = "ì •ë‹µì…ë‹ˆë‹¤! ì°¸ ì˜í•˜ì…¨ì–´ìš” ğŸ‘";
        els.msg.className = "message good";
        els.btn.textContent = "ë‹¤ìŒ ë¬¸ì œ í’€ê¸°";
        els.btn.onclick = nextQuiz;
        isFinished = true;
        render(); 
      } else {
        // [ìˆ˜ì •ë¨] ì˜¤ë‹µ ì‹œ ì „ì²´ ì´ˆê¸°í™” ë¡œì§
        els.msg.textContent = "í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì²˜ìŒë¶€í„° í•´ë³´ì„¸ìš”!";
        els.msg.className = "message bad";
        
        // 0.5ì´ˆ ë’¤ì— ì´ˆê¸°í™” (ì‚¬ìš©ìê°€ í‹€ë ¸ìŒì„ ì¸ì§€í•  ì‹œê°„ ë¶€ì—¬)
        setTimeout(() => {
            currentSlots = [null, null, null]; // ì„ íƒê°’ ì „ë¶€ ì´ˆê¸°í™”
            render(); // í™”ë©´ ê°±ì‹  (ë³´ê¸°ë„ ë‹¤ì‹œ í™œì„±í™”ë¨)
            // ì‹œê°ì  í”¼ë“œë°± (ê¹œë¹¡ì„)
            els.dropZone.style.borderColor = "var(--wrong)";
            setTimeout(() => els.dropZone.style.borderColor = "#555", 800);
        }, 300);
      }
    }

    function nextQuiz() {
      currentIdx++;
      if (currentIdx >= quizData.length) {
        document.body.innerHTML = `
          <div class="container" style="text-align:center; padding-top:50px; border:1px solid #333;">
            <h1 style="color:var(--primary)">ê±´ê°•í•œ ë‘ë‡Œ ì™„ì„±!</h1>
            <p style="font-size:20px; line-height:1.6; color:#ddd;">
              ëª¨ë“  ë¬¸ì œë¥¼ ë§ì¶”ì…¨ìŠµë‹ˆë‹¤.<br>
              ìˆ˜ê³  ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤.
            </p>
            <button class="action-btn" onclick="location.reload()" style="margin-top:40px;">ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸°</button>
          </div>
        `;
      } else {
        initQuiz();
      }
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    initQuiz();
  </script>
</body>
</html>
